<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>draggableTable</title>
    <style type="text/css">
        #draggableTable td{
            border:solid 1px gray;
        }
    </style>
</head>
<body>
<table id="draggableTable">
    <thead>
    <tr>
        <th>
            Heading
        </th>
        <th>
            Another Heading
        </th>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td>
            row 1, cell 1
        </td>
        <td>
            row 1, cell 2
        </td>
    </tr>
    <tr>
        <td>
            row 2, cell 1
        </td>
        <td>
            row 2, cell 2
        </td>
    </tr>
    <tr>
        <td>
            row 3, cell 1
        </td>
        <td>
            row 3, cell 2
        </td>
    </tr>
    <tr>
        <td>
            row 4, cell 1
        </td>
        <td>
            row 4, cell 2
        </td>
    </tr>
    </tbody>
</table>
<script type="text/javascript">
    window.onload = function(){
        //variables
        var draggableTable = document.getElementById("draggableTable");
        var draggingShowDiv = document.createElement("div");
        var currentMoveTr = null;
        //initation
        initDraggingShowDiv();
        bindMouseEvents();
        //bind functions
        function bindMouseEvents(){
            for(i = 0; i < draggableTable.rows.length; i++){
                draggableTable.rows[i].cells[0].onmousedown = function(){
                    mouseDownOnTd(this.parentNode);
                };
                draggableTable.rows[i].cells[0].onmousemove = function(){
                    mouseMoveOnTd(this.parentNode);
                };
                draggableTable.rows[i].cells[0].onmouseup = function(){
                    mouseUpOnTd(this.parentNode);
                };
                draggableTable.rows[i].cells[0].onmouseout = function(){
                    mouseOutTd(this.parentNode);
                };
                draggableTable.rows[i].cells[0].style.cursor = "move";
            }
        }


        //dragging functions
        function mouseDownOnTd(Obj){
            varCurrentMoveTr(Obj);
        }

        function mouseMoveOnTd(Obj){
            if(isCurrentMoveTrExist()){
                turnBottomBorderRed(Obj);
                showDraggingShowDiv();
            }
        }

        function mouseUpOnTd(Obj){
            doMoveTr(Obj);
            clearCurrentMoveTr();
            hideDraggingShowDiv();
        }

        function mouseOutTd(Obj){
            turnBottomBorderGray(Obj);
        }

        //justifying functions
        function isCurrentMoveTrExist(){
            return (currentMoveTr != null);
        }
        //var functions
        function varCurrentMoveTr(Obj){
            currentMoveTr = Obj;
        }
        function clearCurrentMoveTr(){
            currentMoveTr = null;
        }
        //about draggingShowDiv
        function initDraggingShowDiv(){
            draggingShowDiv.style.position = "absolute";
            draggingShowDiv.style.display = "none";
            document.body.appendChild(draggingShowDiv);
        }

        function showDraggingShowDiv(){
            //draggingShowDiv.style.pixelTop = document.body.scrollTop + event.clientY + 10;
            //draggingShowDiv.style.pixelLeft = document.body.scrollLeft + event.clientX + 10;
            draggingShowDiv.innerHTML = '<table style="border:solid 1px gray;"><tr>' + currentMoveTr.innerHTML + '</table></tr>';
            draggingShowDiv.style.backgroundColor = "brown";
            draggingShowDiv.style.display = "inline";
        }

        function hideDraggingShowDiv(){
            draggingShowDiv.style.display = "none";
        }

        //about the red postion indicator
        function turnBottomBorderRed(trObj){
            for(i = 0; i < trObj.cells.length; i++){
                trObj.cells[i].style.borderBottomColor = "red";
            }
        }

        function turnBottomBorderGray(trObj){
            for(i = 0; i < trObj.cells.length; i++){
                trObj.cells[i].style.borderBottomColor = "gray";
            }
        }

        //disable text selection
        // function disableTextSelection() {
        // document.body.setAttribute("onselectstart", "return false;");
        // }
        // function enableTextSelection() {
        // document.body.removeAttribute("onselectstart");
        // }
        //do moving functions
        function doMoveTr(Obj){
            if(isCurrentMoveTrExist()){
                var newTr = draggableTable.insertRow(returnTrIndex(Obj) + 1);
                newTr.innerHTML = currentMoveTr.innerHTML;
                draggableTable.deleteRow(returnTrIndex(currentMoveTr));
                bindMouseEvents();
            }
        }


        //common lib
        function returnTrIndex(trObj){
            for(i = 0; i < draggableTable.rows.length; i++){
                if(draggableTable.rows[i] == trObj){
                    return i;
                }
            }
        }
    };
</script>
</body>
</html>